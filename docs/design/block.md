---
title: 基于umi区块的实践
---

## 背景

公司内维护多个系统，每个系统中做的业务虽然不同，但是会有很多的通用的功能和组件，导致每个人都会重新写一遍。

## 实现

根据公司内部开发习惯以及脚手架规范，将重复的区块分成三类，分别是`hooks`，`components`，`utils`。
开发环境主要采用(dumi)[https://d.umijs.org/zh-CN]进行搭建

其中主要的实现步骤如下：

1. 拉取或更新区块仓库到缓存区。
2. 获取区块仓库中区块内容信息。
3. 将区块依赖内容与当前项目做比较并进行更新。
4. 将对应区块内容复制到对应目录。

### 缓存区

一开始本想缓存到系统根目录中和一些`gloabl`依赖缓存到一起，避免每个项目都拉取一遍，但由于 mac 系统的权限问题最终放弃。

缓存区主要模仿`umi`的区块开发，在`node_modules`中创建了一个`.[cliName]_cache`的缓存目录，进行区块仓库的缓存。

### 内容信息

每个区块下面的结构都如下：

- src `区块源文件`
  - index.tsx `区块内容文件`
- readme.md `区块文档`
- package.json `区块信息`

`src`下面的内容为区块源文件目录，将会被拷贝到项目中。

`readme.md`该文件主要为当前区块文档，将会展示到区块站点文档中。

`package.json`中间记录了该区块的依赖其中有`dependencies`,`devDependencies`,`cli_dependencies`。其中`cli_dependencies`表示区块之间是否存在相互依赖的关系,结构为字符串数组。

### 依赖比较

依赖比较上主要的策略就是项目中本身就存在的依赖就不进行更新，项目中假如没有的依赖，并且区块中存在多个，则选取版本最高的那个版本号进行 install。
